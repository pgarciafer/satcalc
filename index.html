<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Satellite Calculator Look Angle</title>
  <style>
    :root{font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
    body{display:flex;align-items:center;justify-content:center;min-height:100vh;margin:0;background:linear-gradient(180deg,#f8fafc,#eef2ff)}
    .card{background:#ffffff;border-radius:12px;box-shadow:0 10px 30px rgba(2,6,23,0.08);padding:20px;max-width:580px;width:95%;}
    h1{font-size:18px;margin:0 0 16px;color:#0f172a;text-align:center}
    .coords{display:flex;flex-direction:column;gap:12px;margin-top:12px}
    .coord-item{display:flex;align-items:center;gap:8px;background:#f8fafc;padding:8px 12px;border-radius:8px}
    .coord-item label{width:140px;color:#0f172a;font-weight:500;}
    .coord-item input{flex:1;text-align:center;border:none;background:transparent;font-size:18px;color:#0f172a;outline:none;appearance:textfield;}
    .coord-item input::-webkit-outer-spin-button,
    .coord-item input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    .coord-item input {
  flex: 1;
  text-align: center;
  border: 2px solid #cbd5e1;
  background: #f1f5f9;
  font-size: 18px;
  color: #0f172a;
  outline: none;
  border-radius: 6px;
  padding: 4px 6px;
  transition: border-color 0.2s, background 0.2s;
}

.coord-item input:focus {
  border-color: #0ea5a4;
  background: #ffffff;
}

    .coord-item select{font-size:16px;padding:4px 6px;border-radius:6px;border:1px solid #cbd5e1;background:white;color:#0f172a;}
    .muted{color:#94a3b8;font-size:13px;margin-top:12px;text-align:center}
    .actions{display:flex;gap:8px;margin-top:14px;justify-content:center}
    button{padding:8px 12px;border-radius:8px;border:0;background:#0ea5a4;color:white;cursor:pointer;font-weight:500}
    button.secondary{background:#64748b}
    .error{color:#b91c1c}
    .diagrams{display:flex;justify-content:space-around;align-items:center;margin-top:20px}
    .diagram-block{display:flex;flex-direction:column;align-items:center;justify-content:center}
    canvas{background:#fff;display:block;}
    .result-label{text-align:center;font-weight:600;margin-top:6px;color:#0f172a}
  </style>
</head>
<body>
  <div class="card" role="region" aria-label="Device coordinates">
    <h1>Satellite Calculator Look Angle</h1>

    <div class="coords" aria-live="polite">
      <div class="coord-item">
        <label for="lat">Latitude</label>
        <input id="lat" type="number" step="0.01" placeholder="0.00" />
        <select id="latDir"><option value="N">N</option><option value="S">S</option></select>
      </div>
      <div class="coord-item">
        <label for="lon">Longitude</label>
        <input id="lon" type="number" step="0.01" placeholder="0.00" />
        <select id="lonDir"><option value="E">E</option><option value="W">W</option></select>
      </div>
      <div class="coord-item">
        <label for="satLon">Satellite Longitude</label>
        <input id="satLon" type="number" step="0.01" value="18.00" />
        <select id="satLonDir"><option value="E">E</option><option value="W">W</option></select>
      </div>
    </div>

    <div class="actions">
      <button id="refreshBtn">Refresh</button>
      <button id="copyBtn" class="secondary" disabled>Copy</button>
    </div>

    <div class="diagrams">
      <div class="diagram-block">
        <canvas id="azCanvas" width="220" height="220"></canvas>
        <div class="result-label" id="azLabel">Az: --°</div>
      </div>
      <div class="diagram-block">
        <canvas id="elCanvas" width="220" height="220"></canvas>
        <div class="result-label" id="elLabel">El: --°</div>
      </div>
    </div>

    <div class="muted" id="status">Waiting for location permission...</div>
  </div>

  <script>
    const latEl = document.getElementById('lat');
    const lonEl = document.getElementById('lon');
    const latDir = document.getElementById('latDir');
    const lonDir = document.getElementById('lonDir');
    const satLonEl = document.getElementById('satLon');
    const satLonDir = document.getElementById('satLonDir');
    const statusEl = document.getElementById('status');
    const refreshBtn = document.getElementById('refreshBtn');
    const copyBtn = document.getElementById('copyBtn');
    const azCanvas = document.getElementById('azCanvas');
    const elCanvas = document.getElementById('elCanvas');
    const azLabel = document.getElementById('azLabel');
    const elLabel = document.getElementById('elLabel');

    function showStatus(msg, isError=false){
      statusEl.textContent = msg;
      statusEl.classList.toggle('error', !!isError);
    }

    function normalizeInput(input, max){
      if(input.value === '') return;
      let num = parseFloat(input.value);
      if(isNaN(num)) return;
      if(num > max) num = max;
      if(num < 0) num = 0;
      input.value = num.toFixed(2);
    }

    function setLatLon(lat, lon){
      if(lat >= 0){ latDir.value = 'N'; latEl.value = Math.min(90, Math.abs(lat)).toFixed(2); }
      else{ latDir.value = 'S'; latEl.value = Math.min(90, Math.abs(lat)).toFixed(2); }
      if(lon >= 0){ lonDir.value = 'E'; lonEl.value = Math.min(180, Math.abs(lon)).toFixed(2); }
      else{ lonDir.value = 'W'; lonEl.value = Math.min(180, Math.abs(lon)).toFixed(2); }
    }

    function getLatLon(){
      const latVal = parseFloat(latEl.value) || 0;
      const lonVal = parseFloat(lonEl.value) || 0;
      const satLonVal = parseFloat(satLonEl.value) || 0;
      const lat = latDir.value === 'N' ? latVal : -latVal;
      const lon = lonDir.value === 'E' ? lonVal : -lonVal;
      const satLon = satLonDir.value === 'E' ? satLonVal : -satLonVal;
      return { lat, lon, satLon };
    }

    function calculateLookAngles(lat, lon, satLon){
      const a = 6378.137, Rs = 42164.0;
      const phi = lat * Math.PI/180;
      const lam = lon * Math.PI/180;
      const lamSat = satLon * Math.PI/180;

      const xs = Rs * Math.cos(lamSat);
      const ys = Rs * Math.sin(lamSat);
      const zs = 0;

      const xo = a * Math.cos(phi) * Math.cos(lam);
      const yo = a * Math.cos(phi) * Math.sin(lam);
      const zo = a * Math.sin(phi);

      const dx = xs - xo, dy = ys - yo, dz = zs - zo;

      const sinphi = Math.sin(phi), cosphi = Math.cos(phi);
      const sinlam = Math.sin(lam), coslam = Math.cos(lam);

      const east  = -sinlam*dx + coslam*dy;
      const north = -sinphi*coslam*dx - sinphi*sinlam*dy + cosphi*dz;
      const up    =  cosphi*coslam*dx + cosphi*sinlam*dy + sinphi*dz;

      const az = (Math.atan2(east, north)*180/Math.PI + 360) % 360;
      const el = Math.atan2(up, Math.sqrt(east*east+north*north)) * 180/Math.PI;
      return { az, el };
    }

    function drawAz(az){
      const ctx = azCanvas.getContext('2d');
      const w = azCanvas.width, h = azCanvas.height;
      ctx.clearRect(0,0,w,h);
      const cx = w/2, cy = h/2, r = Math.min(w,h)/2 - 12;

      ctx.beginPath(); ctx.arc(cx,cy,r,0,2*Math.PI); ctx.strokeStyle='black'; ctx.lineWidth=2; ctx.stroke();

      ctx.fillStyle='#0f172a'; ctx.font='14px Inter'; ctx.textAlign='center'; ctx.textBaseline='middle';
      ctx.fillText('N', cx, cy-r+6); ctx.fillText('S', cx, cy+r-6);
      ctx.fillText('W', cx-r+6, cy); ctx.fillText('E', cx+r-6, cy);

      const ang = (az-90) * Math.PI/180;
      const x = cx + r * Math.cos(ang);
      const y = cy + r * Math.sin(ang);
      ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(x,y); ctx.strokeStyle='blue'; ctx.lineWidth=3; ctx.stroke();

      azLabel.textContent = `Az: ${az.toFixed(2)}°`;
    }

    function drawEl(el){
      const ctx = elCanvas.getContext('2d');
      const w = elCanvas.width, h = elCanvas.height;
      ctx.clearRect(0,0,w,h);
      const cx = w/2, cy = h/2, r = Math.min(w,h)/2 - 12;

      ctx.beginPath();
      for(let t=0;t<=90;t+=2){
        const a = t * Math.PI/180;
        const x = cx + r * Math.cos(a);
        const y = cy - r * Math.sin(a);
        if(t===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      }
      ctx.strokeStyle='black'; ctx.lineWidth=2; ctx.stroke();

      [0,45,90].forEach(m=>{
        const a = m * Math.PI/180;
        const lx = cx + (r-28) * Math.cos(a);
        const ly = cy - (r-28) * Math.sin(a);
        ctx.fillStyle='#0f172a'; ctx.font='12px Inter'; ctx.textAlign='center'; ctx.textBaseline='middle';
        ctx.fillText(`${m}°`, lx, ly);
      });

      const a = el * Math.PI/180;
      const ex = cx + r * Math.cos(a);
      const ey = cy - r * Math.sin(a);
      ctx.beginPath(); ctx.moveTo(cx,cy); ctx.lineTo(ex,ey); ctx.strokeStyle='blue'; ctx.lineWidth=3; ctx.stroke();

      elLabel.textContent = `El: ${el.toFixed(2)}°`;
    }

    function updateDiagrams(){
      const { lat, lon, satLon } = getLatLon();
      const { az, el } = calculateLookAngles(lat, lon, satLon);
      drawAz(az);
      drawEl(el);
      copyBtn.disabled = false;
    }

    async function getAndShowLocation(){
      showStatus('Requesting location...');
      copyBtn.disabled = true;
      if (!('geolocation' in navigator)){
        showStatus('Geolocation API not supported by this browser.', true);
        return;
      }
      const opts = { enableHighAccuracy: true, maximumAge: 0, timeout: 20000 };
      return new Promise((resolve) => {
        navigator.geolocation.getCurrentPosition(
          pos => {
            const coords = pos.coords;
            setLatLon(coords.latitude, coords.longitude);
            copyBtn.disabled = false;
            showStatus(`Location loaded (accuracy ±${Math.round(coords.accuracy)} m).`);
            updateDiagrams();
            resolve(coords);
          },
          err => {
            let msg='';
            switch(err.code){
              case err.PERMISSION_DENIED: msg='Permission denied.'; break;
              case err.POSITION_UNAVAILABLE: msg='Position unavailable.'; break;
              case err.TIMEOUT: msg='Location request timed out.'; break;
              default: msg = err.message || 'Unknown geolocation error.';
            }
            showStatus(msg,true);
            resolve(null);
          }, opts);
      });
    }

    [latEl, lonEl, satLonEl].forEach(el=>{
      el.addEventListener('keydown', e=>{ if(e.key === 'Enter'){ normalizeInput(el, el===latEl?90:180); updateDiagrams(); } });
      el.addEventListener('blur', ()=>{ normalizeInput(el, el===latEl?90:180); });
    });
    [latDir, lonDir, satLonDir].forEach(sel=> sel.addEventListener('change', ()=> updateDiagrams()));

    refreshBtn.addEventListener('click', ()=> getAndShowLocation());

    copyBtn.addEventListener('click', async ()=>{
      const { lat, lon, satLon } = getLatLon();
      const { az, el } = calculateLookAngles(lat, lon, satLon);
      const text = `${Math.abs(lat).toFixed(2)}° ${lat>=0?'N':'S'}, ${Math.abs(lon).toFixed(2)}° ${lon>=0?'E':'W'}, Sat ${Math.abs(satLon).toFixed(2)}° ${satLon>=0?'E':'W'} | Az ${az.toFixed(2)}°, El ${el.toFixed(2)}°`;
      try{ await navigator.clipboard.writeText(text); const prev = copyBtn.textContent; copyBtn.textContent = 'Copied!'; setTimeout(()=>copyBtn.textContent = prev,1200);}catch(e){alert('Unable to copy: '+e.message)}
    });
    // Auto-select value on focus
[latEl, lonEl, satLonEl].forEach(el => {
  el.addEventListener('focus', e => {
    // Delay selection slightly so it doesn't get overridden
    setTimeout(() => e.target.select(), 0);
  });
});


    window.addEventListener('DOMContentLoaded', ()=> getAndShowLocation());
  </script>
</body>
</html>
